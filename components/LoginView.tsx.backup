```typescript
import React, { useState } from 'react';
import authService from '../services/auth-service';

interface LoginViewProps {
    onLogin: () => void;
}

const LoginView: React.FC<LoginViewProps> = ({ onLogin }) => {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [username, setUsername] = useState('');
    const [confirmPassword, setConfirmPassword] = useState('');
    const [showPassword, setShowPassword] = useState(false);
    const [isRegistering, setIsRegistering] = useState(false);
    const [error, setError] = useState('');
    const [message, setMessage] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    // Modal state
    const [showResetModal, setShowResetModal] = useState(false);
    const [resetEmail, setResetEmail] = useState('');
    const [resetError, setResetError] = useState('');

    const handleAuth = async () => {
        setMessage('');
        setError('');
        
        if (!email.trim() || !password.trim()) {
            setError('请输入账号和密码');
            return;
        }

        if (isRegistering && !username.trim()) {
            setError('请输入用户名');
            return;
        }

        if (isRegistering && !confirmPassword.trim()) {
            setError('请确认密码');
            return;
        }

        // Basic email validation regex
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
             setError('请输入有效的邮箱地址');
             return;
        }

        if (isRegistering) {
            if (password !== confirmPassword) {
                setError('两次输入的密码不一致');
                return;
            }
            
            // NOTE: 调用真实的注册 API
            setIsLoading(true);
            try {
                await authService.register(email, password, username);
                setMessage('注册成功！正在为您自动登录...');
                setTimeout(() => {
                    onLogin();
                }, 1500);
            } catch (err: any) {
                setError(err.message || '注册失败，请稍后重试');
            } finally {
                setIsLoading(false);
            }
            return;
        }

        // NOTE: 调用真实的登录 API
        setIsLoading(true);
        try {
            await authService.login(email, password);
            onLogin();
        } catch (err: any) {
            setError(err.message || '登录失败，请检查账号密码');
        } finally {
            setIsLoading(false);
        }
    };

    const toggleMode = () => {
        setIsRegistering(!isRegistering);
        setError('');
        setMessage('');
        setEmail('');
        setPassword('');
        setConfirmPassword('');
    };

    const openResetModal = () => {
        setResetEmail('');
        setResetError('');
        setShowResetModal(true);
    };

    const handleResetSubmit = () => {
        if (!resetEmail.trim()) {
            setResetError('请输入邮箱地址');
            return;
        }
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(resetEmail)) {
            setResetError('请输入有效的邮箱地址');
            return;
        }
        
        // Success: Close modal and show message on main screen
        setShowResetModal(false);
        setMessage(`重置密码链接已发送至 ${ resetEmail } `);
        setError('');
    };

    const handleKeyDown = (e: React.KeyboardEvent) => {
        if (e.key === 'Enter') {
            handleAuth();
        }
    };

    return (
        <div className="relative z-10 flex flex-col h-full w-full max-w-md mx-auto px-6 pt-16 pb-8 min-h-screen">
             <div className="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
                <div className="absolute -top-[10%] -left-[10%] w-[60%] h-[60%] rounded-full bg-primary/20 blur-[120px] mix-blend-screen opacity-60"></div>
                <div className="absolute -bottom-[10%] -right-[10%] w-[70%] h-[70%] rounded-full bg-secondary/15 blur-[130px] mix-blend-screen opacity-50"></div>
            </div>

            {/* Forgot Password Modal */}
            {showResetModal && (
                <div className="absolute inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200 rounded-3xl">
                    <div className="w-full max-w-xs bg-[#151926] border border-white/10 rounded-2xl p-6 shadow-2xl space-y-5 transform scale-100 animate-in zoom-in-95 duration-200">
                        <div className="space-y-1 text-center">
                            <h3 className="text-xl font-bold text-white font-body">重置密码</h3>
                            <p className="text-xs text-gray-400 font-body leading-relaxed">请输入您的注册邮箱，我们将向您发送重置链接以验证身份。</p>
                        </div>

                        <div className="space-y-3">
                            {resetError && (
                                <div className="text-red-400 text-xs font-medium flex items-center justify-center gap-1 bg-red-500/10 py-1.5 rounded-lg border border-red-500/10">
                                    <span className="material-symbols-outlined text-sm">error</span>
                                    {resetError}
                                </div>
                            )}

                            <div className="group flex items-center w-full rounded-xl bg-[#050508]/50 border border-white/10 focus-within:border-primary/60 focus-within:shadow-[0_0_15px_rgba(37,71,244,0.2)] transition-all">
                                <div className="pl-4 pr-3 text-gray-400">
                                    <span className="material-symbols-outlined text-xl">mail</span>
                                </div>
                                <input 
                                    className="w-full bg-transparent border-none text-white placeholder-gray-500/80 focus:ring-0 h-12 py-3 pl-0 pr-4 text-sm font-body" 
                                    placeholder="输入邮箱地址" 
                                    type="email"
                                    value={resetEmail}
                                    onChange={(e) => setResetEmail(e.target.value)}
                                    autoFocus
                                />
                            </div>
                        </div>

                        <div className="flex gap-3">
                            <button 
                                onClick={() => setShowResetModal(false)}
                                className="flex-1 h-11 rounded-xl bg-white/5 hover:bg-white/10 text-white/70 text-sm font-medium transition-colors border border-white/5"
                            >
                                取消
                            </button>
                            <button 
                                onClick={handleResetSubmit}
                                className="flex-1 h-11 rounded-xl bg-gradient-to-r from-primary to-primary-light hover:to-primary text-white text-sm font-bold transition-all shadow-[0_4px_15px_rgba(37,71,244,0.3)] hover:shadow-[0_4px_20px_rgba(37,71,244,0.5)]"
                            >
                                发送
                            </button>
                        </div>
                    </div>
                </div>
            )}

            <div className="flex-none flex flex-col items-center justify-center text-center space-y-4 mb-8 z-10">
                <div className="relative w-20 h-20 rounded-2xl bg-gradient-to-br from-primary/80 to-secondary/80 p-[1px] shadow-[0_0_30px_rgba(37,71,244,0.4)]">
                    <div className="w-full h-full bg-surface-dark/90 rounded-2xl flex items-center justify-center backdrop-blur-sm">
                        <span className="material-symbols-outlined text-4xl text-transparent bg-clip-text bg-gradient-to-br from-blue-400 to-purple-400" style={{ fontVariationSettings: "'FILL' 1" }}>
                            graphic_eq
                        </span>
                    </div>
                </div>
                <div className="space-y-2">
                    <h1 className="text-4xl font-bold tracking-tight text-white drop-shadow-[0_0_10px_rgba(37,71,244,0.5)] font-body">
                        {isRegistering ? '创建账号' : '欢迎回来'}
                    </h1>
                    <h2 className="text-xl font-medium tracking-tight text-white/90 font-body">
                        {isRegistering ? '开启你的' : '发现你的'}
                        <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">声音之旅</span>
                    </h2>
                </div>
                <p className="text-white/40 text-xs font-display tracking-wider uppercase">Voice Twin ID</p>
            </div>

            <div className="flex-1 flex flex-col justify-center z-10 pb-8">
                <div className="bg-[#141623]/40 backdrop-blur-xl border border-white/5 w-full rounded-3xl p-6 sm:p-8 space-y-6 shadow-2xl relative overflow-hidden">
                    
                    {error && (
                         <div className="flex items-center gap-2 p-3 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-xs font-medium animate-in fade-in slide-in-from-top-1 duration-200">
                            <span className="material-symbols-outlined text-sm">error</span>
                            {error}
                        </div>
                    )}

                    {message && (
                         <div className="flex items-center gap-2 p-3 rounded-xl bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-xs font-medium animate-in fade-in slide-in-from-top-1 duration-200 shadow-[0_0_10px_rgba(16,185,129,0.1)]">
                            <span className="material-symbols-outlined text-sm">check_circle</span>
                            {message}
                        </div>
                    )}

                    <div className="space-y-2">
                        <label className="text-xs font-medium text-gray-400 ml-1">账号</label>
                        <div className={`group flex items - center w - full rounded - xl bg - [#1a1d2d] / 80 border transition - all duration - 300 ${ error && !email ? 'border-red-500/50 shadow-[0_0_15px_rgba(239,68,68,0.15)]' : 'border-white/5 focus-within:shadow-[0_0_15px_rgba(37,71,244,0.3)] focus-within:border-primary/60' } `}>
                            <div className={`pl - 4 pr - 3 transition - colors ${ error && !email ? 'text-red-400' : 'text-gray-400 group-focus-within:text-primary' } `}>
                                <span className="material-symbols-outlined text-xl">mail</span>
                            </div>
                            <input 
                                className="w-full bg-transparent border-none text-white placeholder-gray-500/80 focus:ring-0 h-12 py-3 pl-0 pr-4 text-sm font-body" 
                                placeholder="电子邮箱" 
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                onKeyDown={handleKeyDown}
                            />
                        </div>
                    </div>

                    <div className="space-y-2">
                        <label className="text-xs font-medium text-gray-400 ml-1">密码</label>
                        <div className={`group flex items - center w - full rounded - xl bg - [#1a1d2d] / 80 border transition - all duration - 300 ${ error && !password ? 'border-red-500/50 shadow-[0_0_15px_rgba(239,68,68,0.15)]' : 'border-white/5 focus-within:shadow-[0_0_15px_rgba(37,71,244,0.3)] focus-within:border-primary/60' } `}>
                            <div className={`pl - 4 pr - 3 transition - colors ${ error && !password ? 'text-red-400' : 'text-gray-400 group-focus-within:text-primary' } `}>
                                <span className="material-symbols-outlined text-xl">lock</span>
                            </div>
                            <input 
                                className="w-full bg-transparent border-none text-white placeholder-gray-500/80 focus:ring-0 h-12 py-3 pl-0 pr-4 text-sm font-body" 
                                placeholder="请输入密码" 
                                type={showPassword ? "text" : "password"}
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                onKeyDown={handleKeyDown}
                            />
                            <button 
                                onClick={() => setShowPassword(!showPassword)}
                                className="pr-4 pl-2 text-gray-500 hover:text-white transition-colors focus:outline-none"
                            >
                                <span className="material-symbols-outlined text-xl">
                                    {showPassword ? 'visibility' : 'visibility_off'}
                                </span>
                            </button>
                        </div>
                    </div>

                    {isRegistering && (
                        <div className="space-y-2 animate-in fade-in slide-in-from-top-2 duration-300">
                            <label className="text-xs font-medium text-gray-400 ml-1">确认密码</label>
                            <div className={`group flex items - center w - full rounded - xl bg - [#1a1d2d] / 80 border transition - all duration - 300 ${ error && (!confirmPassword || password !== confirmPassword) ? 'border-red-500/50 shadow-[0_0_15px_rgba(239,68,68,0.15)]' : 'border-white/5 focus-within:shadow-[0_0_15px_rgba(37,71,244,0.3)] focus-within:border-primary/60' } `}>
                                <div className={`pl - 4 pr - 3 transition - colors ${ error && (!confirmPassword || password !== confirmPassword) ? 'text-red-400' : 'text-gray-400 group-focus-within:text-primary' } `}>
                                    <span className="material-symbols-outlined text-xl">lock_reset</span>
                                </div>
                                <input 
                                    className="w-full bg-transparent border-none text-white placeholder-gray-500/80 focus:ring-0 h-12 py-3 pl-0 pr-4 text-sm font-body" 
                                    placeholder="请再次输入密码" 
                                    type={showPassword ? "text" : "password"}
                                    value={confirmPassword}
                                    onChange={(e) => setConfirmPassword(e.target.value)}
                                    onKeyDown={handleKeyDown}
                                />
                            </div>
                        </div>
                    )}

                    {!isRegistering && (
                        <div className="flex justify-end">
                            <button 
                                onClick={openResetModal}
                                className="text-xs text-gray-400 hover:text-white transition-colors"
                            >
                                忘记密码？
                            </button>
                        </div>
                    )}

                    <button 
                        onClick={handleAuth}
                        className="relative w-full overflow-hidden rounded-xl group h-14 shadow-[0_4px_20px_rgba(37,71,244,0.3)] hover:shadow-[0_4px_25px_rgba(37,71,244,0.5)] transition-all duration-300 transform active:scale-[0.98]"
                    >
                        <div className="absolute inset-0 bg-gradient-to-r from-primary to-secondary transition-all duration-300 group-hover:scale-105"></div>
                        <div className="absolute inset-0 bg-white/0 group-hover:bg-white/10 transition-colors"></div>
                        <span className="relative flex items-center justify-center gap-2 text-white font-bold text-base tracking-wide font-body">
                            {isRegistering ? '立即注册' : '登录'}
                            <span className="material-symbols-outlined text-sm">arrow_forward</span>
                        </span>
                    </button>
                </div>
            </div>

            <div className="flex-none pb-4 text-center z-10">
                <p className="text-sm text-gray-500 font-body">
                    {isRegistering ? '已有账号？' : '还没有账号？'}
                    <button 
                        onClick={toggleMode}
                        className="font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400 hover:opacity-80 transition-opacity ml-1"
                    >
                        {isRegistering ? '立即登录' : '立即免费注册'}
                    </button>
                </p>
            </div>
        </div>
    );
};

export default LoginView;